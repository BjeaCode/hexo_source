---
title: CF372C Watching Fireworks is Fun
date: 2022-01-26 16:01:55
tags:
  - DP
  - 单调队列
categories: 题解
author: Mr_Stranger_CW
mathjax: true
---

## $Watching\ Fireworks\ is Fun$

给定一条有$n$个观测节点的路，你可以选择在原地不动，从$i$移动到$i-1$($i\not=1$)或从$i$移动到$i+1$($i\not=n$)。你每秒进行$d$次这些操作。

现在有$m$场烟花表演，第$i$场烟花表演的位置在$a_i$，快乐值为$b_i$，时间在$t_i$。

当第$i$场表演开始时，假设你在观测节点$x$，此时你获得的快乐值是$b_i-|a_i-x|$。

时刻$0$你可以在任意一个节点上，请问当$m$场演出结束之后，你能获得的最大总欢乐值是多少？

$n\leq 1.5\times 10^5,m\leq 300$

先对表演按照时间排序。

$DP$单调队列优化好题。


我们定义$dp[i][j]$表示的是第$i$场烟火表演开始时在观测节点$j$的最大欢乐值。

先抓一只朴素的$DP$狮子：

$$
dp[i][j]=\max\limits_{k\in[min(1,j-d(t_i-t_{i-1})),max(n,j+d(t_i-t_{i-1}))]}\{dp[i-1][k]+b_i-|j-a_i|\}
$$

时间复杂度为$O(n^2m)$，不是很能接受。

发现这里面有关$k$的只有$dp[i-1][k]$，所以当我们只是从路一侧向另一侧推的时候可以用单调队列维护最大值。

所以左到右转移一遍，再从右到左转移一遍单调队列优化即可。

当发现当前点和队头距离太大时弹出即可。

时间复杂度$O(nm)$可以通过本题。