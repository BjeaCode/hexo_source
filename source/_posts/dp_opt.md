---
title: 基础动态规划优化
date: 2022-01-24 22:00:44
tags:
  - DP
categories: 学习笔记
author: Mr_Stranger_CW
mathjax: true
---

# 蒟蒻浅谈如何尝试入门部分基础$DP$优化初步
### 斜率优化！
先给个大概念：对于一只$DP$狮子，如果这只狮子可以被表达为以下形式，且狮子中的$A^4_j$随着时间的推移（或者说$i$的增大）单调不减，则他可以进行斜率优化。这里以最小值为例子。

设$A^k_i$是仅与变量$i$相关的第$k$个狮子的组成部分。
设$B^k_i$是至多只与变量$i$相关的第$k$个狮子的组成部分。
$$
A^1_i=\min (A^2_j-B^3_iA^4_j)
$$
好现在我们来介绍斜率优化的斜率他在哪里。

对于一条直线$Y=KX+B$我们给他变换一个形式

得到狮子$B=Y-KX$

这时候我们发现将最上面的狮子换一个形式，变成$B=Y-KX$。

我们令：

$$
\begin{cases}
B_i=A^1_i\\
Y_i=A^2_i\\
K_i=B^3_i\\
X_i=A^4_i\\
\end{cases}
$$

而我们的目的，是令$B_i$最小。

根据一些初中知识，我们发现$B$正是直线$Y=KX+B$的纵截距。

而原式可以变为$B_i=\min(Y_j-K_iX_j)$

而在$i$不变的时候，$K_i$不变。

所以现在我们的问题转化为，一条斜率为$K_i$的直线，经过某个点$(X_j,Y_j)$的最小纵截距是多少。

感性理解一下，现在平面上有很多的点，我们把这条直线从很靠下的地方一点点上移，直到碰到某个点。这个时候纵截距是最小的。

因为一些显而易见的事实，我们发现这个最先被碰到的点一定在下凸包上。

所以说，我们对于每一个位置的决策，将$(X_j,Y_j)$作为坐标扔到平面直角坐标系上去单调栈线性维护凸包即可（这也是为什么前面要求$A_i^4$单调，不然时间会退化）。

至于在凸包上我们会碰到那个点就可用二分解决，因为下凸包斜率单调增，所以我们只需要二分出第一个点使得这个点和前面的点的构成斜线的斜率$k_1$和他和后面的点组成的直线的斜率$k_2$满足$k1\leq K<k2$即可，等号取哪边视题目而定。

这样的话可以把一些需要$O(n^2)$的动态规划所需的时间压缩到$O(nlog_2n)$。

同时，如果说我们发现$K_i$单调递增，那么我们就可以把下凸包的栈换成双端队列，进行单调队列优化使得时间降为$O(n)$。

注意边界，如当$X$相等时的斜率计算等。

最大值记录的话就是把上边那一堆自行反过来。

### 四边形不等式优化！
一般用于区间$DP$

一只$DP$狮子形似：
$$
dp[i][j]=\min(dp[i][k-1]+dp[k][j]+w(k,j))
$$
其中的$w(a,b)$满足：
$$
\forall a \leq b<c \leq d 
$$
$$
w(a,c)+w(b,d)\leq w(a,d)+w(b,c)
$$
则我们称之为满足四边形不等式。

若$w(a,b)$满足：
$$
\forall a \leq b\leq c \leq d 
$$
$$
w(b,c)\leq w(a,d)
$$
则我们称之为满足区间包含单调性。

满足四边形不等式的动态规划拥有决策单调性，即如果存在一个新决策点比当前最优决策点更优，那么当前的最优决策点在新决策点加入后不可能再次成为最优决策点。
