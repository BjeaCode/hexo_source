---
title: CF516D Drazil and Morning Exercise
date: 2022-01-26 16:35:00
tags:
  - 并查集
  - 树上问题
categories: 题解
author: Jocker_CW
mathjax: true
---

# 。
题目大意：给定一颗有边权树，记函数$f(x)$表示**在整棵树中**距离点$x$最远的点与$x$的距离。

$n\leq 10^5,q\leq 50$

现在给定一个上界$l$，求最大联通块个数$|s|$使得$\max\limits_{p\in x}f(x)-\min\limits_{p\in x}f(x)\leq l$。

一开始拿到这个题一点头绪都没有，还把题意理解错了，一直以为这个$f(x)$是在选择的联通块中计算的。

后来我们发现了一些奇妙的性质。性质是啥一会再说，那个是证明会用的。

将所有$f(x)$j计算出来后，我们将他们排序，然后直接尺取加并查集计算最大点数即可，复杂度$O(nq)$。

为什么是对的？我们在去除点的时候不会破坏并查集所维护的联通性么？

观察这个$f(x)$，我们可以得出$f(x)$取到最大值的点是在整颗树的直径的两端。

紧接着发现，对于每一个点，我们一定能找到一个方法让他走到直径上（本来就在就相当于没动）然后向较长的一端走去。

我们很轻易就能发现直径的终点$f(x)$的取值是最小的。我们钦定直径中点$mid$是整颗树的根。

因为每个在直径上的点一定会向离自己远的直径一段走去，所以一定会经过终点。

所以当$mid$成为根的时候，每一个儿子的$f(x)$取值一定要比父亲的$f(x)$要大。

故这棵以$mid$为根的树是一个小根堆。

所以当我们将所有的$f(x)$从大到小排序后，在尺子左右端点移动过程中，我们弹出的一个节点他的儿子一定比他先弹出去，所以不对联通性造成破坏。

并查集维护其$size$即可。