---
title: CF587C Duff in the Army
date: 2022-01-26 16:41:00
tags:
  - 主席树
  - LCA
categories: 题解
author: Mr_Stranger_CW
mathjax: true
---

# 。
### 牵制芝士：主席树，$LCA$。

**题目大意：**

给定一棵$n$个节点的树。有$m$个人，第$i$个人住在节点$c_i$上。$q$次询问，每次询问如$(u,v,a)$，询问路径$u\rightarrow v$上居住的（包括$u,v$）编号前$a$小的人的编号。如若人数不足$a$，则输出所有人的编号。在输出编号之前，你还应输出你会输出多少编号。

$1\leq n,q\leq 10^5,a\leq 10$

**[根据题面瞎编的故事版](https://www.luogu.com.cn/paste/txkj7gjz)（供欣赏，可以不看）**


### **正题开始**

回到做法，看到“树”，“路径”，这时候应该已经开始敲$LCA$了，树剖和倍增均可。

由于求前$a$小值，还是静态的，对每一个节点开一个桶，记录到树根的信息。然后需要的时候再进行调用即可。

但是观察数据范围，发现不是很行。

这里我们可以使用树上主席树的方法，直接记录即可。

对于每一次询问，我们先求出$LCA$，然后直接利用主席树求解。

但是这里有可能是两条链？怎么快速求前$a$小值？

不慌，我们用$cnt1,cnt2$分别表示两条链已经取到了第几小值，每一次跑主席树$logn$求出后比较即可。

需要注意的是，注意记录两条链的$size$和，不然到后面因为主席树的一些性质可能导致求根本不存在的值的时候返回两个$m$，这个时候就会炸。判一下。